# Лабораторная работа №5: Razor Pages. Передача файлов

## Теория
В этой работе я познакомился с технологией Razor Pages для создания страниц администрирования и реализовал механизм загрузки файлов (изображений) на сервер.

### Ключевые понятия
- **Razor Pages**: Странично-ориентированная модель программирования в ASP.NET Core, где каждая страница состоит из файла разметки (`.cshtml`) и файла кода (`.cshtml.cs`, PageModel). Отличается от MVC тем, что логика обработки запроса находится непосредственно в классе страницы, а не в контроллере.
- **Scaffolding (Скаффолдинг)**: Автоматическая генерация кода (страниц CRUD) на основе моделей данных.
- **IFormFile**: Интерфейс в ASP.NET Core, представляющий загруженный файл.
- **Multipart/form-data**: Тип кодирования данных формы, необходимый для передачи файлов через HTTP.
- **Areas (Области)**: Способ организации функциональных модулей приложения (например, `Admin`).

## Ход работы
1.  **API (Серверная часть)**:
    - Реализовал Use-Case `SaveImage` (с использованием MediatR) для сохранения загруженных файлов в папку `wwwroot/Images`.
    - Обновил `DishEndpoints`: методы `POST` (создание) и `PUT` (обновление) теперь принимают данные формы (`[FromForm]`) и файлы.
    - Реализовал логику удаления старого изображения при обновлении или удалении объекта (`DeleteImage`).

2.  **UI Service (Клиентская часть)**:
    - Доработал `ApiProductService`: методы создания и обновления теперь используют `MultipartFormDataContent`.
    - Это позволяет отправлять JSON-данные объекта и бинарные данные файла в одном запросе.

3.  **Административная панель (Razor Pages)**:
    - Создал область `Admin` (`Areas/Admin`).
    - С помощью скаффолдинга сгенерировал CRUD-страницы для сущности `Dish`.
    - *Особенность*: Так как UI-проект не имеет прямого доступа к БД, пришлось временно создать `TempDbContext` для работы скаффолдера, а затем удалить его.

4.  **Рефакторинг и доработка UI**:
    - Переписал сгенерированные `PageModel` (Index, Create, Edit, Delete, Details), заменив прямой доступ к `DbContext` на вызовы `IProductService`.
    - Добавил поле загрузки файла (`<input type="file">`) и атрибут `enctype="multipart/form-data"` в формы создания и редактирования.
    - Настроил явную маршрутизацию для страниц (например, `@page "/admin/product/edit/{id:int}"`).
    - Обновил меню навигации для доступа к админке.

## Использованные инструменты
- **VS Code**
- **.NET CLI**
- **dotnet-aspnet-codegenerator** (инструмент скаффолдинга)
- **MediatR** (в API)
